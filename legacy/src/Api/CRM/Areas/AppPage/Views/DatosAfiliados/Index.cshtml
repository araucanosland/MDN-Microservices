@{
    ViewBag.Title = "Ingreso";
    Layout = "~/Views/Shared/_MdnLayout.cshtml";
}

<!--Masked Input [ OPTIONAL ]-->
<script src="~/Assets/plugins/masked-input/jquery.maskedinput.min.js"></script>
<!--Magic Checkbox [ OPTIONAL ]-->
<link href="~/Assets/plugins/magic-check/css/magic-check.min.css" rel="stylesheet">

<link href="~/Assets/plugins/bootstrap-validator/bootstrapValidator.min.css" rel="stylesheet">
<!--Bootstrap Select [ OPTIONAL ]-->
<link href="~/Assets/plugins/bootstrap-select/bootstrap-select.min.css" rel="stylesheet">

<link href="~/Assets/plugins/x-editable/css/bootstrap-editable.css" rel="stylesheet">
<!--TypeaheadJS [ OPTIONAL ]-->
<link href="~/Assets/plugins/x-editable/inputs-ext/typeaheadjs/lib/typeahead.js-bootstrap.css" rel="stylesheet">
<!--Address [ OPTIONAL ]-->
<link href="~/Assets/plugins/x-editable/inputs-ext/address/address.css" rel="stylesheet">
<link href="~/Assets/css/demo/nifty-demo-icons.min.css" rel="stylesheet" />
<link href="~/Assets/css/demo/nifty-demo.min.css" rel="stylesheet">

<link href="~/Assets/plugins/chosen/chosen.min.css" rel="stylesheet">

<style>
    div.list-group {
        height: 150px;
        overflow: scroll;
    }
</style>

<!--Page content-->
<!--===================================================-->
<div id="page-content">
    <div class="row">
        <div class="col-lg-12">
            <div class="panel">
                <div class="panel-body">
                    <h2 class="panel-title">
                        <span class="pull-left badge badge-danger" style="border-radius: 4px; display: none;" id="msjNoMoles">No Molestar</span><span class="pull-left badge badge-success" style="border-radius: 4px; margin-left: 5px; display:none" id="cumpleanos">Afiliado esta de Cumpleaños</span><span class="pull-left badge badge-warning" style="border-radius: 4px; margin-left: 5px; display:none" id="afinuevo">Afi Nuevo</span><span class="pull-left badge badge-success" style="border-radius: 4px; margin-left: 5px;" id="afiVigente"></span><span class="pull-left badge badge-danger" style="border-radius: 4px; margin-left: 5px; display:none" id="afiFallecido "></span><span class="pull-left badge badge-danger" style="border-radius: 4px; margin-left: 5px; display:none" id="afiContac">Actualizar Contactos</span>
                    </h2>
                    <hr />
                    <div class="row">
                        <div class="col-sm-3">
                            <div class="form-group">
                                <div class="panel pos-rel" style="border-radius: 5px;">
                                    <div class="pad-all text-center">
                                        <div class="widget-control" style="display: none;">
                                            <div class="btn-group dropdown">
                                                <a href="" class="dropdown-toggle btn btn-trans" data-toggle="dropdown" aria-expanded="false" style="margin-left: 167px; border-color: white;"><i class="demo-psi-dot-vertical icon-lg"></i></a>
                                                <ul class="dropdown-menu dropdown-menu-right" style="">
                                                    <li><a href=""><i class="icon-lg icon-fw demo-psi-pen-5"></i> Edit</a></li>
                                                    <li><a href=""><i class="icon-lg icon-fw demo-pli-recycling"></i> Remove</a></li>
                                                    <li class="divider"></li>
                                                    <li><a href=""><i class="icon-lg icon-fw demo-pli-mail"></i> Send a Message</a></li>
                                                    <li><a href=""><i class="icon-lg icon-fw demo-pli-calendar-4"></i> View Details</a></li>
                                                    <li><a href=""><i class="icon-lg icon-fw demo-pli-find-user"></i> Lock</a></li>
                                                </ul>
                                            </div>
                                        </div>
                                        <img alt="Profile Picture" class="img-lg img-circle mar-ver" id="imGenero">
                                        <p class="text-lg text-semibold mar-no text-main" id="NombreAfiliado" style="font-size: 11px;"></p>
                                        <p class="text-sm" id="SegmentoAfi" name="SegmentoAfi" style="font-size: 15px;"></p>
                                        <div class="pad-top btn-groups">
                                            <span class="btn btn-icon ion-ios-chatbubble-outline icon-2x add-tooltip" data-original-title="Comentarios" data-container="body" data-type="textarea" id="EditComentarios" style="border-bottom: inherit; color: #7d8d9d;"></span>
                                            @*<span id="EditNoMolestar" data-type="text" data-pk="1" data-placement="right" style="border-bottom: inherit; color: #7d8d9d;" class="btn btn-icon ion-ios-telephone-outline icon-2x add-tooltip" data-original-title="No Molestar" data-container="body"></span>*@
                                            <a href="#" id="EditNoMolestar" data-type="select" data-pk="1" data-value="" data-title="Select sex" style="border-bottom: inherit; color: #7d8d9d;" class="btn btn-icon ion-ios-telephone-outline icon-2x add-tooltip" data-original-title="No Molestar" data-container="body"></a>
                                            <span id="DesacNoMolestar" data-type="text" data-pk="1" data-placement="right" style="border-bottom: inherit; color: #7d8d9d;" class="btn btn-icon ion-ios-telephone-outline icon-2x add-tooltip" data-original-title="Desactivar No Molestar" data-container="body"></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-sm-9">
                            <div class="form-group">
                                <div class="row">
                                    <div class="col-sm-2">
                                        <div class="form-group">
                                            <h5><label class="control-label">RUT:</label></h5>
                                        </div>
                                    </div>
                                    <div class="col-sm-4">
                                        <div class="form-group">
                                            @*   <h5><label class="control-label" id="RutAfiliado">Sin Información</label></h5>*@
                                            <input type="text" class="control-label text-dark" name="RutAfiliado" id="RutAfiliado" readonly="readonly" style="font-weight:bold" />
                                        </div>
                                    </div>
                                    <div class="col-sm-2">
                                        <div class="form-group">
                                            <h5><label class="control-label">Empresa:</label></h5>
                                        </div>
                                    </div>
                                    <div class="col-sm-4">
                                        <div class="form-group">
                                            <select id="slRutEmpresa" name="slRutEmpresa" class="form-control text-dark" style="font-weight:bold"></select>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-2">
                                        <div class="form-group">
                                            <h5><label class="control-label">Fecha Nacimiento:</label></h5>
                                        </div>
                                    </div>
                                    <div class="col-sm-4">
                                        <div class="form-group">
                                            @*<h5><label class="control-label" id="FDNAfiliado">Sin Información</label>&nbsp;(<label class="control-label" id="AniosAfiliado"></label>&nbsp;Años)</h5>*@
                                            <input type="text" class="control-label text-dark" name="FDNAfiliado" id="FDNAfiliado" readonly="readonly" style="font-weight: bold;" />
                                            <div class="label label-table label-success" style="display:none">Cumpleaños</div>
                                        </div>
                                    </div>
                                    <div class="col-sm-2">
                                        <div class="form-group">
                                            <h5><label class="control-label">Rut:</label></h5>
                                        </div>
                                    </div>
                                    <div class="col-sm-4">
                                        <div class="form-group">
                                            @*  <h5><label class="control-label" id="NombreEmpresaAfi">Sin Información</label></h5>*@
                                            <input type="text" class="control-label text-dark" name="NombreEmpresaAfi" id="NombreEmpresaAfi" readonly="readonly" style="font-weight: bold;" />
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-2">
                                        <div class="form-group">
                                            <h5><label class="control-label">Celular:</label></h5>
                                        </div>
                                    </div>
                                    <div class="col-sm-4">
                                        <div class="form-group">
                                            @*<h5><label class="control-label" id="CelAfiliado">Sin Información</label></h5>*@
                                            <input type="text" class="control-label text-dark" name="CelAfiliado" id="CelAfiliado" readonly="readonly" style="font-weight: bold;" />
                                        </div>
                                    </div>


                                    <div class="col-sm-2">
                                        <div class="form-group">
                                            <h5><label class="control-label">Fono Fijo:</label></h5>
                                        </div>
                                    </div>
                                    <div class="col-sm-3">
                                        <div class="form-group">
                                            @*<h5><label class="control-label" id="FonoAfiliado">Sin Información</label></h5>*@
                                            <input type="text" class="control-label text-dark" name="FonoAfiliado" id="FonoAfiliado" readonly="readonly" style="font-weight: bold;" />
                                        </div>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-sm-2">
                                        <div class="form-group">
                                            <h5><label class="control-label">Email:</label></h5>
                                        </div>
                                    </div>
                                    <div class="col-sm-4">
                                        <div class="form-group">
                                            @*<h5><label class="control-label" id="EmailAfiliado">Sin Información</label></h5>*@
                                            <input type="text" class="control-label text-dark" name="EmailAfiliado" id="EmailAfiliado" readonly="readonly" style="font-weight: bold;" />
                                        </div>
                                    </div>

                                    <div class="col-sm-2">
                                        <div class="form-group">
                                            <h5><label class="control-label">Afiliado Desde:</label></h5>
                                        </div>
                                    </div>
                                    <div class="col-sm-4">
                                        <div class="form-group">
                                            @*<h5><label class="control-label" id="OrigenAfiliado">Sin Información</label></h5>*@
                                            <input type="text" class="control-label text-dark" name="OrigenAfiliado" id="OrigenAfiliado" readonly="readonly" style="font-weight: bold;" />
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-2">
                                        <div class="form-group">
                                            <h5><label class="control-label">Renta:</label></h5>
                                        </div>
                                    </div>
                                    <div class="col-sm-7">
                                        <div class="form-group">
                                            @*<h5>$<label class="control-label" id="RentaAfiliado">Sin Información</label>&nbsp;(<label class="control-label" id="RentaAfiPeriodo"></label>&nbsp;Última Informada)</h5>*@
                                            <span class="control-label text-dark" style="font-weight: bold;">$</span><input type="text" class="control-label text-dark" name="RentaAfiliado" id="RentaAfiliado" readonly="readonly" style="font-weight: bold;" /><br />&nbsp;&nbsp;<span class="control-label" style="font-size: 11px;">(</span><label class="control-label" id="RentaAfiPeriodo" style="font-size: 11px;"></label>&nbsp;<span class="control-label" style="font-size: 11px;">&Uacute;ltima Informada)</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-sm-12">
            <div class="panel">

                <!--Panel heading-->
                <div class="panel-heading">
                    <div class="panel-control" style="float:left;">
                        <ul class="nav nav-tabs tabs-left">
                            <li class="active">
                                <a data-toggle="tab" href="#demo-lft-tab-1" aria-expanded="true" id="tab_comercial" class="tab-principal" style="font-weight: bold;">Campa&ntilde;as <span class="badge badge-success" id="cantCamp"></span></a>
                            </li>
                            <li class="">
                                <a data-toggle="tab" href="#demo-lft-tab-4" aria-expanded="false" id="tab_contact" class="tab-principal" style="font-weight: bold;">Contactabilidad<span class="badge badge-success" id="cantAlertas"></span></a>
                            </li>
                            <li class="">
                                <a data-toggle="tab" href="#demo-lft-tab-2" aria-expanded="false" id="tab_alertas" class="tab-principal" style="font-weight: bold;">Alertas<span class="badge badge-success" id="cantAlertas"></span></a>
                            </li>
                            <li class="">
                                <a data-toggle="tab" href="#demo-lft-tab-3" aria-expanded="false" id="tab_relacion" class="tab-principal" style="font-weight: bold;">Relacionamiento</a>
                            </li>
                            <li class="">
                                <a data-toggle="tab" href="#demo-lft-tab-5" aria-expanded="false" id="tab_encuesta" class="tab-principal" style="font-weight: bold;">
                                    <span class="badge badge-header badge-danger" id="AlertaEncuesta" style="display:none"></span>Encuesta
                                </a>
                            </li>

                        </ul>
                    </div>
                    <h3 class="panel-title" style="color:white">.</h3>
                </div>

                <!--Panel body-->
                <div class="panel-body">
                    <div class="tab-content">
                        <div id="demo-lft-tab-1" class="tab-pane fade active in">
                            <div class="panel-body">
                                <div class="row">
                                    <table class="table table-hover table-vcenter">
                                        <thead>
                                            <tr>
                                                <th>Tipo Campa&ntilde;a</th>
                                                <th>Monto </th>
                                                <th>Estado</th>
                                                <th>Sub Estado</th>
                                                <th>Fecha Compromete</th>
                                                <th>Prioridad</th>
                                            </tr>
                                        </thead>
                                        <tbody id="bdy_datos"></tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                        <div id="demo-lft-tab-2" class="tab-pane fade">
                            <div class="panel-body">
                                <div class="row">
                                    <table class="table table-hover table-vcenter">
                                        <thead>
                                            <tr>
                                                <th>Descripci&oacute;n</th>
                                                <th>Valor</th>
                                            </tr>
                                        </thead>
                                        <tbody id="bdy_datosAlertas"></tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                        <div id="demo-lft-tab-3" class="tab-pane fade">
                            <div class="btn-group bootstrap-select">
                                <label class="control-label">Filtro por Estados</label>
                                <select class="selectpicker" id="filtroEstado">
                                    <option value="0">Todos..</option>
                                    <option value="1">Gestion Motor</option>
                                    <option value="2">Comentarios</option>
                                    <option value="3">No Molestar</option>
                                    <option value="4">Desbloqueo no Molestar</option>
                                </select>
                            </div>
                            <div class="timeline two-column">
                                <div class="timeline-header">
                                    <div class="timeline-header-title bg-success">Gestiones</div>
                                </div>
                                <div id="AfiProyeccion"></div>
                                <div class="clearfix"></div>
                            </div>
                        </div>

                        <div id="demo-lft-tab-4" class="tab-pane fade">
                            <div class="panel-body">
                                <div class="row">
                                    <a data-target="#demo-lg-modal-new" data-toggle="modal" class="btn btn-sm btn-primary btn-icon btn-rounded">Nuevo contacto<i class="demo-psi-add icon-lg" style="margin-left: 10px;"></i></a>
                                    <hr />
                                    <table class="table table-hover table-vcenter" style="font-size: 11px;">
                                        <thead>
                                            <tr>
                                                <th>Gestión</th>
                                                <th>Datos Contacto</th>
                                                <th>Tipo contacto</th>
                                                <th>Índice</th>
                                                <th>Ultimo intento</th>
                                                <th>Descripción</th>
                                                <th>Canal Ult. intento</th>
                                                <th>Ultimo Contacto Valido</th>
                                            </tr>
                                        </thead>
                                        <tbody id="bdy_datos_contactos"></tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                        <div id="demo-lft-tab-5" class="tab-pane fade">
                            <div class="panel-body">
                                <div class="row">
                                    @Html.Partial("Encuesta/EncuestaEnfermedades")
                                </div>
                            </div>
                        </div>


                    </div>
                </div>
            </div>
        </div>
    </div>
    <div id="demo-lg-modal-new" class="modal fade" role="dialog" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg" style="width: 500px;">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal"><i class="pci-cross pci-circle"></i></button>
                    <h4 class="modal-title"><img class="img-xs img-circle" src="../Assets/img/profile-photos/eje2.png" alt="Profile picture">Nuevo Contacto</h4>
                </div>
                <form id="form-registro-contacto" action="#" method="post">
                    <div class="modal-body">
                        <div class="form-group">
                            <div class="btn-group bootstrap-select">
                                <label class="control-label">Tipo de Contacto</label>
                                <select class="selectpicker" id="cbtippContac" name="cbtippContac">
                                    <option value=" ">Seleccione..</option>
                                    <option value="1">Celular</option>
                                    <option value="2">Teléfono</option>
                                    <option value="3">Mail</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="btn-group bootstrap-select">
                                <label class="control-label">Clasificación de Contacto</label>
                                <select class="selectpicker" id="cbClasificacionConctac" name="cbClasificacionConctac">
                                    <option value=" ">Seleccione..</option>
                                    <option value="1">Personal</option>
                                    <option value="2">Comercial</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="form-group">
                                <label class="control-label">Datos de Contacto</label>
                                <input class="form-control" id="afi_NewContacto" type="text" value="" maxlength="150" name="afi_NewContacto">
                            </div>
                        </div>
                    </div>

                    <div class="modal-footer">
                        <button data-dismiss="modal" class="btn btn-default" type="button">Cerrar</button>
                        <button class="btn btn-primary" id="btGuardaContacto" type="submit">Guardar Contacto</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div id="demo-lg-modal" class="modal fade" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal"><i class="pci-cross pci-circle"></i></button>
                    <h4 class="modal-title" id="myLargeModalLabel">Gestión Comercial</h4>
                </div>
                <div>

                    <div class="tab-base" style="margin-bottom: 0px !important;">
                        <!--Nav Tabs-->
                        <ul class="nav nav-tabs">

                            <li class="active">
                                <a data-toggle="tab" href="#tab-gestion-2" aria-expanded="false">Historial de Gestión</a>
                            </li>
                            <li class="">
                                <a data-toggle="tab" href="#tab-gestion-4" aria-expanded="false">Filtros</a>
                            </li>
                        </ul>
                        <div class="tab-content" style="box-shadow: 0 0 0 !important;">
                            <div id="tab-gestion-2" class="tab-pane  fade active in">
                                <div class="list-group" id="gestiones_realizadas">
                                </div>
                            </div>
                            <div id="tab-gestion-4" class="tab-pane fade">
                                <div class="table-responsive" style="overflow:scroll; height:150px;">
                                    <table class="table table-striped">
                                        <tbody id="letable"></tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!--Modal footer-->
                <div class="modal-footer" id="mensahes-mustPre">
                    <form id="datos-gestion" action="#" method="post">
                        <div class="row esconder" style="text-align: left;">
                            <div class="col-sm-4">
                                <div class="form-group">
                                    <label class="control-label">Estado</label>
                                    <select class="form-control" id="ges_estado" name="ges_estado">
                                        <option value="">Seleccione</option>
                                    </select>
                                </div>
                            </div>

                            <div class="col-sm-4">
                                <div class="form-group">
                                    <label class="control-label">Sub Estado</label>
                                    <select class="form-control" id="ges_subestado" name="ges_subestado" disabled="disabled">
                                        <option value="">Seleccione</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-sm-4">
                                <div class="form-group" id="fpg">
                                    <label class="control-label">Fecha Próxima Gestión</label>
                                    <div id="demo-dp-component">
                                        <div class="input-group date">
                                            <input type="text" class="form-control" id="ges_prox_gestion" name="ges_prox_gestion">
                                            <span class="input-group-addon"><i class="demo-pli-calendar-4"></i></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row esconder" style="text-align: left;">
                            <div class="col-sm-12">
                                <div class="form-group">
                                    <label class="control-label">Comentarios</label>
                                    <textarea placeholder="Comentarios" rows="3" class="form-control" id="ges_comentarios" name="ges_comentarios"></textarea>
                                </div>
                            </div>

                        </div>
                        <input type="hidden" id="ges_id_asignacion" name="ges_id_asignacion" value="" />
                        <button data-dismiss="modal" class="btn btn-default" type="button">Cerrar</button>
                        <button class="btn btn-primary esconder" id="btn_savear" type="submit">Guardar</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <div id="demo-lg-modal-Normalizacion" class="modal fade" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal"><i class="pci-cross pci-circle"></i></button>
                    <h4 class="modal-title" id="myLargeModalLabel">Gestión Normalización</h4>
                </div>
                <div class="modal-body">

                    <div class="tab-base" style="margin-bottom: 0px !important;">
                        <!--Nav Tabs-->
                        <ul class="nav nav-tabs">
                            <li class="active">
                                <a data-toggle="tab" href="#tab-gestionNor-2" aria-expanded="false">Historial de Gestión</a>
                            </li>
                        </ul>
                        <div class="tab-content" style="box-shadow: 0 0 0 !important;">
                            <div id="tab-gestionNor-2" class="tab-pane  fade active in">
                                <div class="list-group" id="gestiones_realizadasNorm">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer" id="mensahes-mustNor">
                    <form id="datos-gestion_normalizacion" action="#" method="post">
                        <div class="row esconder" style="text-align: left;">
                            <div class="col-sm-3">
                                <div class="form-group">
                                    <label class="control-label">Causa basal</label>
                                    <select class="form-control" id="ges_causa_basal_normalizacion" name="ges_causa_basal_normalizacion">
                                        <option value="">Seleccione</option>
                                    </select>
                                </div>
                            </div>

                            <div class="col-sm-3">
                                <div class="form-group">
                                    <label class="control-label">Consecuencia</label>
                                    <select class="form-control" id="ges_consecuencia_normalizacion" name="ges_consecuencia_normalizacion">
                                        <option value="">Seleccione</option>
                                    </select>
                                </div>
                            </div>

                            <div class="col-sm-3">
                                <div class="form-group">
                                    <label class="control-label">Estado</label>
                                    <select class="form-control" id="ges_estado_normalizacion" name="ges_estado_normalizacion">
                                        <option value="">Seleccione</option>
                                    </select>
                                </div>
                            </div>

                            <div class="col-sm-3">
                                <div class="form-group" id="fpg_normalizacion">
                                    <label class="control-label">Fecha Próxima Gestión</label>
                                    <div id="demo-dp-component_normalizacion">
                                        <div class="input-group date">
                                            <input type="text" class="form-control" id="ges_prox_gestion_normalizacion" name="ges_prox_gestion_normalizacion">
                                            <span class="input-group-addon"><i class="demo-pli-calendar-4"></i></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row esconder" style="text-align: left;">
                            <div class="col-sm-12">
                                <div class="form-group">
                                    <label class="control-label">Comentarios</label>
                                    <textarea placeholder="Comentarios" rows="3" class="form-control" id="ges_comentarios_normalizacion" name="ges_comentarios_normalizacion"></textarea>
                                </div>
                            </div>
                        </div>

                        <input type="hidden" id="ges_id_asignacion_normalizacion" name="ges_id_asignacion_normalizacion" value="" />
                        @* <label id="ges_id_asignacion_normalizacion" name="ges_id_asignacion_normalizacion" style="display:none;"></label>*@
                        <button data-dismiss="modal" class="btn btn-default" type="button">Cerrar</button>
                        <button class="btn btn-primary esconder" id="btn_savear_normalizacion" type="submit">Guardar</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div id="demo-lg-modal-sc" class="modal fade" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal"><i class="pci-cross pci-circle"></i></button>
                    <h4 class="modal-title" id="myLargeModalLabel">Gestión SC</h4>
                </div>
                <div class="modal-body">
                    <div class="tab-base" style="margin-bottom: 0px !important;">
                        <!--Nav Tabs-->
                        <ul class="nav nav-tabs">

                            <li class="active">
                                <a data-toggle="tab" href="#tab-gestionSC-2" aria-expanded="false">Historial de Gestión</a>
                            </li>

                        </ul>
                        <div class="tab-content" style="box-shadow: 0 0 0 !important;">
                            <div id="tab-gestionNor-2" class="tab-pane  fade active in">
                                <div class="list-group" id="gestiones_realizadasSC">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer" id="mensahes-mustsc">

                    <form id="datos-gestion-sc" action="#" method="post">
                        <div class="row esconder" style="text-align: left;">
                            <div class="col-sm-4">
                                <div class="form-group">
                                    <label class="control-label">Estado</label>
                                    <select class="form-control" id="ges_estadoSC" name="ges_estadoSC">
                                        <option value="">Seleccione</option>
                                    </select>
                                </div>
                            </div>

                            <div class="col-sm-4">
                                <div class="form-group">
                                    <label class="control-label">Sub Estado</label>
                                    <select class="form-control" id="ges_subestadoSC" name="ges_subestadoSC" disabled="disabled">
                                        <option value="">Seleccione</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-sm-4">
                                <div class="form-group" id="fpgSC">
                                    <label class="control-label">Fecha Próxima Gestión</label>
                                    <div id="demo-dp-componentSC">
                                        <div class="input-group date">
                                            <input type="text" class="form-control" id="ges_prox_gestionSC" name="ges_prox_gestionSC">
                                            <span class="input-group-addon"><i class="demo-pli-calendar-4"></i></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row esconder" style="text-align: left;">
                            <div class="col-sm-12">
                                <div class="form-group">
                                    <label class="control-label">Comentarios</label>
                                    <textarea placeholder="Comentarios" rows="3" class="form-control" id="ges_comentariosSC" name="ges_comentariosSC"></textarea>
                                </div>
                            </div>

                        </div>

                        <input type="hidden" id="ges_id_asignacionSC" name="ges_id_asignacionSC" value="" />
                        <button data-dismiss="modal" class="btn btn-default" type="button">Cerrar</button>
                        <button class="btn btn-primary esconder" id="btn_savear" type="submit">Guardar</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <div id="demo-lg-modal-tmc" class="modal fade" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal"><i class="pci-cross pci-circle"></i></button>
                    <h4 class="modal-title" id="myLargeModalLabel">Gestión TMC</h4>
                </div>
                <div class="modal-body">

                    <div class="tab-base" style="margin-bottom: 0px !important;">
                        <!--Nav Tabs-->
                        <ul class="nav nav-tabs">

                            <li class="active">
                                <a data-toggle="tab" href="#tab-gestionTmc-2" aria-expanded="false">Historial de Gestión</a>
                            </li>

                        </ul>
                        <div class="tab-content" style="box-shadow: 0 0 0 !important;">
                            <div id="tab-gestionNor-2" class="tab-pane  fade active in">
                                <div class="list-group" id="gestiones_realizadasTMC">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer" id="mensahes-musttmc">
                    <form id="datos-gestion-tmc" action="#" method="post">
                        <div class="row esconder" style="text-align: left;">
                            <div class="col-sm-4">
                                <div class="form-group">
                                    <label class="control-label">Estado</label>
                                    <select class="form-control" id="ges_estadoTMC" name="ges_estadoTMC">
                                        <option value="">Seleccione</option>
                                    </select>
                                </div>
                            </div>

                            <div class="col-sm-4">
                                <div class="form-group">
                                    <label class="control-label">Sub Estado</label>
                                    <select class="form-control" id="ges_subestadoTMC" name="ges_subestadoTMC" disabled="disabled">
                                        <option value="">Seleccione</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-sm-4">
                                <div class="form-group" id="fpgTMC">
                                    <label class="control-label">Fecha Próxima Gestión</label>
                                    <div id="demo-dp-componentTMC">
                                        <div class="input-group date">
                                            <input type="text" class="form-control" id="ges_prox_gestionTMC" name="ges_prox_gestionTMC">
                                            <span class="input-group-addon"><i class="demo-pli-calendar-4"></i></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row esconder" style="text-align: left;">
                            <div class="col-sm-12">
                                <div class="form-group">
                                    <label class="control-label">Comentarios</label>
                                    <textarea placeholder="Comentarios" rows="3" class="form-control" id="ges_comentariosTMC" name="ges_comentariosTMC"></textarea>
                                </div>
                            </div>

                        </div>

                        <input type="hidden" id="ges_id_asignacionTMC" name="ges_id_asignacionTMC" value="" />
                        <input type="hidden" id="ges_oficina" name="ges_oficina" value="" />
                        <input type="hidden" id="ges_token" name="ges_token" value="" />


                        <button data-dismiss="modal" class="btn btn-default" type="button">Cerrar</button>
                        <button class="btn btn-primary esconder" id="btn_savear" type="submit">Guardar</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="col-sm-6 text-xs-left"> </div>
<input type="hidden" id="temporalid" name="temporalid" value="" />
<!--===================================================-->
<!--End page content-->
@section script{

    <script src="~/Assets/plugins/fooTable/dist/footable.all.min.js"></script>
    <script src="~/Assets/plugins/bootstrap-validator/bootstrapValidator.min.js"></script>
    <!--Bootstrap Select [ OPTIONAL ]-->
    <script src="~/Assets/plugins/bootstrap-select/bootstrap-select.min.js"></script>
    <!--Bootbox Modals [ OPTIONAL ]-->
    <script src="~/Assets/plugins/bootbox/bootbox.min.js"></script>
    <!--Masked Input [ OPTIONAL ]-->
    <script src="~/Assets/plugins/masked-input/jquery.maskedinput.min.js"></script>
    <script src="~/Assets/js/jquery.rut.chileno.min.js"></script>
    <script src="~/Assets/plugins/fooTable/dist/footable.all.min.js"></script>

    <!--MomentJS [ OPTIONAL ]-->
    <script src="~/Assets/plugins/momentjs/moment.min.js"></script>

    <!--X-editable [ OPTIONAL ]-->
    <script src="~/Assets/plugins/x-editable/js/bootstrap-editable.min.js"></script>
    <script src="~/Assets/plugins/x-editable/inputs-ext/address/address.js"></script>

    <script src="~/Assets/plugins/chosen/chosen.jquery.min.js"></script>


    <script type="text/javascript">

        $(document).on('nifty.ready', function () {
            $("#demo-editable-sex").editable({
                prepend: "not selected",
                source: [
                    { value: 1, text: "Male" },
                    { value: 2, text: "Female" }
                ],
                text: "hola",

                display: function (value, sourceData) {
                    var colors = { "": "gray", 1: "green", 2: "blue" },
                        elem = $.grep(sourceData, function (o) { return o.value == value; });

                    if (elem.length) {
                        $(this).text(elem[0].text).css("color", colors[value]);
                    } else {
                        $(this).empty();
                    }
                }
            });
            $('#DesacNoMolestar').html('')
            $('#EditComentarios').html('')

            $('#DesacNoMolestar').editable('option', 'validate', function () {
                $('#DesacNoMolestar').html('')
                $.SecGetJSON(BASE_URL + "/motor/api/Afiliados/quita-marcaNoMolestar-afiliado", { RutAfiliado: $('#RutAfiliado').val() }, function (datos) {
                    $('#DesacNoMolestar').html('')
                    $("#msjNoMoles").css({ 'display': 'none' })
                    $('#DesacNoMolestar').hide()
                    $('#EditNoMolestar').show()
                    Cargador.CargaProyeccion()
                    $.niftyNoty({
                        type: 'success',
                        icon: 'pli-like-2 icon-2x',
                        message: 'Se quito marca No Molestar correctamente.',
                        container: 'floating',
                        timer: 5000
                    });
                });
            });

            $("#EditComentarios").editable({
                showbuttons: "bottom",
                validate: function (value) {
                    if ($.trim(value) != "") {
                        var _comentario = $.trim(value)
                        $('#EditComentarios').html('')
                        $.SecGetJSON(BASE_URL + "/motor/api/Afiliados/guarda-comentario-afiliado", { RutAfiliado: $('#RutAfiliado').val(), Observacion: _comentario }, function (datos) {
                            $('#EditComentarios').html('')
                            Cargador.CargaProyeccion()
                            $.niftyNoty({
                                type: 'success',
                                icon: 'pli-like-2 icon-2x',
                                message: 'Se agrego Comentario correctamente.',
                                container: 'floating',
                                timer: 5000
                            });
                        });
                    }
                    else {
                        return "Comentario Requerido..";
                    }
                },
            });
            $("#EditNoMolestar").editable({
                source: [
                    { value: 'Cliente Molesto', text: 'Cliente Molesto' },
                    { value: 'Cliente Fallecido', text: 'Cliente Fallecido' },
                    { value: 'Cliente no interezado', text: 'Cliente no interezado' },
                    { value: 'Otros', text: 'Otros' }
                ],
                validate: function (value) {
                    if ($.trim(value) != "") {
                        var _motivo = $.trim(value)
                        $('#EditNoMolestar').html('')
                        $.SecGetJSON(BASE_URL + "/motor/api/Afiliados/guarda-no-molestar", { RutAfiliado: $('#RutAfiliado').val(), Motivo: _motivo }, function (datos) {
                            $('#EditNoMolestar').html('')
                            $("#msjNoMoles").css({ 'display': 'block' })
                            $('#EditNoMolestar').hide()
                            $('#DesacNoMolestar').show()
                            Cargador.CargaProyeccion()
                            $.niftyNoty({
                                type: 'success',
                                icon: 'pli-like-2 icon-2x',
                                message: 'Se Activo No Molestar correctamente.',
                                container: 'floating',
                                timer: 5000
                            });
                        });
                    }
                    else {
                        return "Ingrese un motivo..";
                    }
                }
            });
        });

        var _temoralid = 0;
        var Cargador = {
            CargaDatosAfiliados: function (p_rut) {
                $.SecGetJSON(BASE_URL + "/motor/api/Afiliados/obtener-info-afiliado", { RutAfiliado: p_rut }, function (e) {
                    console.log($('.editable-input'))


                    if (e.RutAfiliado == null) {
                        $("#NombreAfiliado").html("Afiliado Sin Información");
                    }
                    else {
                        $("#RutAfiliado").val(e.RutAfiliado);
                        $("#NombreAfiliado").html(e.Nombres);
                        $("#FDNAfiliado").val(e.FechaNacimiento);
                        $("#AniosAfiliado").html(e.Edad);
                        $("#CelAfiliado").val(e.Cel);
                        $("#FonoAfiliado").val(e.Fono);
                        $("#EmailAfiliado").val(e.Mail);
                        $("#NomAfiliado").html(' Señor(a)  ' + e.Nombres);

                        $("#OrigenAfiliado").val(e.InicioValidezRol);
                    }

                    if (e.Sexo == 'F') {
                        $("#imGenero").attr('src', '../Assets/img/profile-photos/7.png');
                    }
                    else {
                        $("#imGenero").attr('src', '../Assets/img/profile-photos/1.png');
                    }

                    if (e.Vigente == 1) {
                        //$("#afiVigente").html("Afi Vigente").addClass("label-info label-info");

                    }
                    else {
                        $("#afiVigente").html("No Vigente").addClass("label-info label-danger");
                        $("#NombreAfiliado").css({ 'color': 'grey' })
                    }
                    if (e.Fallecido == 1) {
                        console.log("falledio")
                        $("#afiFallecido").show()
                        $("#afiFallecido").html("Fallecido").addClass("label-info label-danger");
                        $("#NombreAfiliado").css({ 'color': 'grey' })
                    }
                    else {
                        $("#afiFallecido").hide();
                    }

                    if (e.FlagNoMolestar == 1) {
                        $("#msjNoMoles").css({ 'display': 'block' })
                        $('#EditNoMolestar').hide()
                        $('#DesacNoMolestar').show()
                        $('#DesacNoMolestar').editable('setValue', e.MotivoNM);

                    } else {
                        $("#msjNoMoles").css({ 'display': 'none' })
                        $('#DesacNoMolestar').hide()
                        $('#EditNoMolestar').show()
                    }
                    $('#DesacNoMolestar').html('')
                    $('#EditComentarios').html('')


                    $.SecGetJSON(BASE_URL + "/motor/api/Afiliados/lista-rut-empresa", { RutAfiliado: p_rut }, function (datos) {

                        $("#slRutEmpresa").html("");
                        $.each(datos, function (i, empresa) {
                            $("#slRutEmpresa").append($("<option>").val(empresa.RutEmpresa).html(empresa.NombreEmpresa));
                        });
                        $("#slRutEmpresa").trigger("change");
                    });

                });
            },
            CargaDatosCumpleanos: function (rutCumpleanos) {
                $.SecGetJSON(BASE_URL + "/motor/api/Afiliados/obtener-cumpleanos", { RutAfiliado: rutCumpleanos }, function (e) {
                    console.log(e.Estado)
                    switch (e.Estado) {
                        case 'Cumpleaños':
                            $("#cumpleanos").show();
                            break;
                        case 'NUEVO':
                            $("#afinuevo").show();
                            break;
                    }
                });
            },

            CargaDatosCampaniasAfiliado: function (p_rutAfi) {
                $("#bdy_datos").html("");
                $.SecGetJSON(BASE_URL + "/motor/api/Afiliados/lista-campanias-afiliado", { RutAfiliado: p_rutAfi }, function (camp) {
                    $.each(camp, function (i, e) {

                        var clase = '';
                        var link = '<a href="#" class="btn-link" data-target="#demo-lg-modal" data-toggle="modal" data-asignacion="' + e.id_Asginacion + '">' + e.Campania + '</a>';
                        switch (e.Campania) {
                            case 'Comercial':
                                clase = 'text-dark';
                                link = '<a href="#" class="btn-link" data-target="#demo-lg-modal" data-toggle="modal" data-asignacion="' + e.id_Asginacion + '">' + e.Campania + '</a>';
                                break;
                            case 'Normalización':
                                clase = 'text-dark';
                                link = '<a href="#" class="btn-link" data-target="#demo-lg-modal-Normalizacion" data-toggle="modal" data-asignacion="' + e.id_Asginacion + '">' + e.Campania + '</a>';
                                break;
                            case 'Seguro Cesantía':
                                clase = 'text-dark';
                                link = '<a href="#" class="btn-link" data-target="#demo-lg-modal-sc" data-toggle="modal" data-asignacion="' + e.id_Asginacion + '">' + e.Campania + '</a>';
                                break;
                            case 'TMC':
                                clase = 'text-dark';
                                link = '<a href="#" class="btn-link" data-target="#demo-lg-modal-tmc" data-toggle="modal" data-asignacion="' + e.id_Asginacion + '">' + e.Campania + '</a>';
                                break;
                        }
                        $("#bdy_datos")
                            .append(
                                $("<tr>")
                                    // .append($("<td>").append(e.Campania))
                                    .append($("<td>").append(link))
                                    .append($("<td>").addClass("text-dark").addClass(clase).text('$' + e.Oferta.toMoney(0)))
                                    .append($("<td>").append(e.Estado))
                                    .append($("<td>").append(e.SubEstado))
                                    .append($("<td>").append(e.FechaCompromete.toFecha() != '01-01-1753' && e.FechaCompromete.toFecha() != '01-01-0001' ? e.FechaCompromete.toFecha() : 'N/A'))
                                    .append($("<td>").append(e.Prioridad.toString().toEtiquetaPrioridadScan()))
                                // .append($("<td>").append((e.HistorialGestion.length > 0 && e.HistorialGestion[0].GestionBase.FechaCompromete.toFecha() != '01-01-1753') ? e.HistorialGestion[0].GestionBase.FechaCompromete.toFecha() : 'N/A'))
                            );
                        $("#cantCamp").html(i + 1)
                    });
                });
            },
            CargaDatosAlertas: function (p_rutAlertas) {
                $("#bdy_datosAlertas").html("");
                $.SecGetJSON(BASE_URL + "/motor/api/Afiliados/lista-alerta-afiliado", { RutAfiliado: p_rutAlertas }, function (menus) {
                    $.each(menus, function (i, e) {
                        var valor = '';
                        var clase = '';
                        console.log(e.TipoValor)
                        switch (e.TipoValor) {
                            case 'Moneda':
                                clase = 'text-bold';
                                valor = parseInt(e.Valor).toMoney(0);
                                break;
                            case 'Fecha':
                                clase = 'text-bold';
                                valor = e.Valor;
                                break;
                        }

                        $("#bdy_datosAlertas")
                            .append(
                                $("<tr>")
                                    .append($("<td>").append(e.Tipo))
                                    .append($("<td>").addClass("text-dark").addClass(clase).text(valor))
                            );
                        $("#cantAlertas").html(i + 1)
                    });
                });
            },

            CargaDatosContactos: function (p_rutAfi) {
                $("#bdy_datos_contactos").html("");
                $.SecGetJSON(BASE_URL + "/motor/api/Contactos/lista-contactos-afi", { RutAfiliado: p_rutAfi }, function (contac) {
                    $.each(contac, function (i, e) {
                        var colorPorc = '';
                        var alertFecha = '';
                        if (e.PorcIndice > 70) {
                            var colorPorc = 'pull-left badge badge-success'
                        }
                        if (e.PorcIndice > 40 && e.PorcIndice < 69) {
                            var colorPorc = 'pull-left badge badge-warning'
                        }
                        if (e.PorcIndice < 39) {
                            var colorPorc = 'pull-left badge badge-danger'
                        }
                        if (e.FechaContacto.toFecha() === "01-01-1900") {
                            alertFecha = e.FechaContacto.toFecha() + '<i class="badge badge-danger badge-stat badge-icon pull-right add-tooltip" style="position: static; data-toggle="tooltip" data-container="body" data-placement="top" data-original-title="Se debe Actualizar Contacto">!</i>'
                            $("#afiContac").css({ 'display': 'block' })
                        }
                        else { alertFecha = e.FechaContacto.toFecha() }
                        $("#bdy_datos_contactos")
                            .append(
                                $("<tr>")
                                    .append($("<td>").append(
                                        $("<select>").addClass('dropdown-caret').css('width', '88px').css('border-radius', '6px').append(
                                            $('<option data-icon="fa fa-paint-brush">').val('Seleccione').text("Seleccione..."),
                                            $('<option>').val(1).text("Valido Presencial"),
                                            $('<option>').val(2).text("Contacto Valido"),
                                            $('<option>').val(3).text("Tercero Valido"),
                                            $('<option>').val(4).text("No Contesta"),
                                            $('<option>').val(5).text("Buzon de voz"),
                                            $('<option>').val(6).text("Apagado"),
                                            $('<option>').val(7).text("Equivocado"),
                                            $('<option>').val(8).text("No Existe")
                                        ).on('change', function () {
                                            console.log($(this).val(), e.ValorDato, p_rutAfi)
                                            var indice = $(this).val();
                                            var valorD = e.ValorDato;
                                            var rutAfi = p_rutAfi;
                                            var ofici = getCookie("Oficina");
                                            $.SecGetJSON(BASE_URL + "/motor/api/Contactos/actualiza-indice-contacto", { Indice: indice, RutAfi: rutAfi, ValorDato: valorD, Oficina: ofici }, function (datos) {
                                                Cargador.CargaDatosContactos(rutAf)
                                                $.niftyNoty({
                                                    type: 'success',
                                                    icon: 'pli-like-2 icon-2x',
                                                    message: 'Gestión Guardada correctamente.',
                                                    container: 'floating',
                                                    timer: 5000
                                                });
                                            });
                                        })
                                    ))
                                    .append($("<td>").append(e.ValorDato))
                                    .append($("<td>").append(e.TipoDato))
                                    .append($("<td>").append('<span class="' + colorPorc + '">' + e.PorcIndice + '</span>'))
                                    .append($("<td>").append(e.FechaIntento.toFecha()))
                                    .append($("<td>").append(e.Descripcion))
                                    .append($("<td>").append(e.OrigenCreacion))
                                    .append($("<td>").append(alertFecha))
                                //.append($("<td>").append(e.FechaContacto.toFecha()))
                            );
                    });
                });
            },
            CargaProyeccion: function () {
                var rutAfilado = httpGet("RutBuscar").replace('.', '');
                $('#AfiProyeccion').html('')
                $.getJSON(BASE_URL + "/motor/api/Afiliados/obtener-proyeccion", { RutAfiliado: rutAfilado.replace('.', '') }, function (respuesta) {
                    $.each(respuesta, function (i, e) {
                        var date = new Date(e.Fecha);
                        var options = {
                            year: "numeric", month: "long",
                            day: "numeric", hour: "2-digit", minute: "2-digit"
                        };
                        var i_img;
                        if (e.EstadoGestion == 1) {
                            i_img = $('<img>').attr('src', '../Assets/img/M.png').attr('alt', 'Profile picture')
                            var iB2_4 = $('<a>').html('   Motor')
                            var aB2_5 = $('<a>').addClass('text-main text-bold').html('Gestion:  ').append(iB2_4).append('<br/>')
                            var iB2_4_ = $('<a>').html(e.Estado + '  -  ' + e.SubEstado)
                            var aB2_5_ = $('<a>').addClass('text-main text-bold').html('Motivo:  ').append(iB2_4_)
                        }
                        else {
                            var iB2_4 = $('<a>').html(e.Estado + '        ')
                            var aB2_5 = $('<a>').addClass('text-main text-bold').html('Gestion:  ').append(iB2_4).append('<br/>')
                            var iB2_4_ = $('<a>').html(e.SubEstado)
                            var aB2_5_ = $('<a>').addClass('text-main text-bold').html('Motivo:  ').append(iB2_4_)
                        }
                        if (e.EstadoGestion == 2) {
                            i_img = $('<i>').addClass('demo-psi-speech-bubble-3 icon-lg')
                        }
                        if (e.EstadoGestion == 3) {
                            i_img = $('<img>').attr('src', '../Assets/img/profile-photos/noFono.png').attr('alt', 'Profile picture')
                        }
                        if (e.EstadoGestion == 4) {
                            i_img = $('<i>').addClass('pli-telephone icon-lg')
                        }
                        var divB1_1 = $('<div>').addClass('timeline-icon bg-success').append(i_img)
                        var divB1_2 = $('<div>').addClass('timeline-time').html(date.toLocaleTimeString("es-ES", options))
                        var divB1 = $('<div>').addClass('timeline-stat').append(divB1_1).append(divB1_2)
                        var imgB2 = $('<img>').addClass('img-xs img-circle').attr('src', '../Assets/img/profile-photos/eje2.png').attr('alt', 'Profile picture')
                        var _eje = $('<a>').html(e.Ejecutivo.OrdenaNombre() + '  -  ' + e.Sucursal)
                        var aB2_1 = $('<a>').addClass('btn-link text-main text-bold').html('ingresado por:' + '  ').append(_eje).append('<br/>')
                        var pB2 = $('<p>').addClass('mar-no pad-btm').append(aB2_1).append(aB2_5).append(aB2_5_)
                        var divB2 = $('<div>').addClass('timeline-label').css('border-radius', '5px').css('background-color', '#e3e5e6').append(imgB2).append(pB2)
                        var divPrin = $('<div>').addClass('timeline-entry').append(divB1).append(divB2)
                        $('#AfiProyeccion').append(divPrin)
                    });
                });
            },
            EstadoEncuesta: function () {
                $("#slRutEmpresa").on("change", function (e) {
                    $.SecGetJSON(BASE_URL + "/motor/api/Afiliados/lista-estado-encuesta", { RutAfiliado: httpGet("RutBuscar") }, function (datos) {
                        if (datos.length != 0) {
                            if (datos[0].Flag_Encuesta == 1) {
                                $('#DivEncusta').css('display', 'none')
                                $('#lbMenesajeEncuensta').css('display', 'block')
                                $('#AlertaEncuesta').css('display', 'none')
                            }
                        }
                        else {
                            $('#DivEncusta').css('display', 'block')
                            $('#lbMenesajeEncuensta').css('display', 'none')
                            $('#AlertaEncuesta').css('display', 'block')
                        }

                    });
                });
            }
        }
        $("#slRutEmpresa").on("change", function (e) {
            $.SecGetJSON(BASE_URL + "/motor/api/Afiliados/obtener-info-empresa", { RutEmpresa: $("#slRutEmpresa").val(), RutAfiliado: rutAf }, function (datos) {
                $("#NombreEmpresaAfi").val(datos.RutEmpresaDv);
                $("#SegmentoAfi").html(datos.RolSegmentoAfiliado);
                $("#RentaAfiliado").val(datos.RentaUltimaInformada.toMoney(0));
                $("#RentaAfiPeriodo").html(datos.PeriodoUltimaRenta);
            });
        });
        //EVENTO CHANGE
        $("#ges_estado").on("change", function () {

            if ($(this).val() != '') {
                $("#ges_subestado").attr("disabled", false);
                $.SecGetJSON(BASE_URL + "/motor/api/Gestion/lista-estados-gestion", { tipoCampagna: 1, padre: $(this).val() }, function (datos) {
                    $("#ges_subestado").html("");
                    $("#ges_subestado").append($("<option>").attr("value", "").html("Seleccione"));
                    //  $('#datos-gestion').bootstrapValidator('updateStatus', 'ges_subestado', 'NOT_VALIDATED').bootstrapValidator('validateField', 'ges_subestado');
                    $.each(datos, function (i, e) {
                        $("#ges_subestado").append($("<option>").attr("value", e.eges_id).html(e.eges_nombre))
                    });
                });
                if ($(this).find("option:selected").data("terminal") == "CERRADOS" || $(this).find("option:selected").data("terminal") == "PENDIENTESNOCAL") {
                    $("#fpg").hide();
                }
                else {
                    $("#fpg").show();
                }
            }
            else {
                $("#ges_subestado").html("");
                $("#ges_subestado").attr("disabled", true);
            }
        });
        $("#ges_estadoSC").on("change", function () {

            if ($(this).val() != '') {
                $("#ges_subestadoSC").attr("disabled", false);
                $.SecGetJSON(BASE_URL + "/motor/api/Gestion/lista-estados-gestion", { tipoCampagna: 4, padre: $(this).val() }, function (datos) {
                    $("#ges_subestadoSC").html("");
                    $("#ges_subestadoSC").append($("<option>").attr("value", "").html("Seleccione"));
                    // $('#datos-ges_subestadoSC').bootstrapValidator('updateStatus', 'ges_subestadoSC', 'NOT_VALIDATED').bootstrapValidator('validateField', 'ges_subestadoSC');
                    $.each(datos, function (i, e) {
                        if (e.ejes_terminal != "SISTEMA") {
                            $("#ges_subestadoSC").append($("<option>").attr("value", e.eges_id).html(e.eges_nombre))
                        }
                    });
                });
                if ($(this).find("option:selected").data("terminal") == "CERRADOS" || $(this).find("option:selected").data("terminal") == "PENDIENTESNOCAL") {
                    $("#fpgSC").hide();
                }
                else {
                    $("#fpgSC").show();
                }
            }
            else {
                $("#ges_subestadoSC").html("");
                $("#ges_subestadoSC").attr("disabled", true);
            }
        });
        $("#ges_estadoTMC").on("change", function () {

            if ($(this).val() != '') {
                $("#ges_subestadoTMC").attr("disabled", false);
                $.SecGetJSON(BASE_URL + "/CPEngine/api/camp/lista-estges-camp", { cc: 8, cp: $(this).val() }, function (datos) {
                    $("#ges_subestadoTMC").html("");
                    $("#ges_subestadoTMC").append($("<option>").attr("value", "").html("Seleccione"));
                    $('#datos-gestion-tmc').bootstrapValidator('updateStatus', 'ges_subestadoTMC', 'NOT_VALIDATED').bootstrapValidator('validateField', 'ges_subestadoTMC');
                    $.each(datos, function (i, e) {
                        console.log(e)
                        $("#ges_subestadoTMC").append($("<option>").attr("value", e.CodEstado).html(e.Nombre))
                    });
                });
                if ($(this).find("option:selected").data("terminal")) {
                    $("#fpgTMC").hide();
                }
                else {
                    $("#fpgTMC").show();
                }
            }
            else {
                $("#ges_subestadoTMC").html("");
                $("#ges_subestadoTMC").attr("disabled", true);
            }
        });
        $('#demo-dp-componentSC .input-group.date').datepicker(
            { autoclose: true, format: 'dd-mm-yyyy', startDate: "0d", language: "es", daysOfWeekDisabled: [6, 0], todayHighlight: true }
        ).on('show.bs.modal hide.bs.modal', function (event) {
            event.stopPropagation();
        });

        $('#demo-dp-componentTMC .input-group.date').datepicker(
            { autoclose: true, format: 'dd-mm-yyyy', startDate: "0d", language: "es", daysOfWeekDisabled: [6, 0], todayHighlight: true }
        ).on('show.bs.modal hide.bs.modal', function (event) {
            event.stopPropagation();
        });

        $('#demo-lg-modal').on('show.bs.modal', function (event) {

            var link = $(event.relatedTarget); // Button that triggered the modal
            var Asignacion = link.data('asignacion');
            if (typeof Asignacion != 'undefined') {
                $('#ges_id_asignacion').val(Asignacion)
            }
            $.SecGetJSON(BASE_URL + "/motor/api/Gestion/lista-estados-gestion", { tipoCampagna: 1, padre: 0 }, function (datos) {
                $("#ges_estado").data("TipoAsignacion", 1);
                $("#ges_estado").html("");
                $("#ges_estado").append($("<option>").attr("value", "").html("Seleccione"));

                $.each(datos, function (i, e) {
                    $("#ges_estado").append($("<option>").attr("value", e.eges_id).html(e.eges_nombre).data("terminal", e.ejes_terminal))
                });
            });
            $.SecGetJSON(BASE_URL + "/motor/api/Afiliados/obtener-hist-tipo-campana", { RutAfiliado: rutAf, TipoAsignacion: 1 }, function (gesList) {
                $("#gestiones_realizadas").html("");
                $.each(gesList, function (i, e) {
                    $("#gestiones_realizadas")
                        .append(
                            $("<a>")
                                .append($("<h4>").addClass("list-group-item-heading").html("<strong>Gestor:</strong> " + e.Nombres))
                                .append($("<p>").addClass("list-group-item-text").html("<strong>Fecha Gestión:</strong>" + e.FechaAccion.toFechaHora() + ",<br/> <strong>Fecha Prox. Gestión:</strong> " + e.FechaCompromete.toFecha()))
                                .append($("<p>").addClass("list-group-item-text").html("<strong>Estado:</strong> " + e.Estado + ",  <strong>Sub Estado:</strong> " + e.SubEstado))
                                .append($("<p>").addClass("list-group-item-text").html("<strong>Comentario:</strong> " + e.Descripcion))
                        );
                });
                if (gesList.length > 0 && gesList[0].EsTerminal === "CERRADOS") {
                    $(".esconder").hide();
                } else {
                    $(".esconder").show();
                }
            });
            $.SecGetJSON(BASE_URL + "/motor/api/Gestion/lista-rechazos-rsg", { Periodo: 201805, RutEmpresa: $("#slRutEmpresa").val(), RutAfiliado: rutAf }, function (datos) {

                $("#letable").html("");
                $.each(datos, function (i, e) {
                    $("#letable").append($("<tr>").append("<td>").html(e.MotivoRechazo))
                });
            });
            $('#demo-dp-component .input-group.date').datepicker(
                { autoclose: true, format: 'dd-mm-yyyy', startDate: "0d", language: "es", daysOfWeekDisabled: [6, 0], todayHighlight: true })
                .on('show.bs.modal hide.bs.modal', function (event) {
                    // prevent datepicker from firing bootstrap modal "show.bs.modal"
                    event.stopPropagation();
                });

        });
        $('#demo-lg-modal-Normalizacion').on('show.bs.modal', function (event) {

            var link = $(event.relatedTarget); // Button that triggered the modal
            var AsignacionNorm = link.data('asignacion');
            if (typeof AsignacionNorm != 'undefined') {
                $("#ges_id_asignacion_normalizacion").val(AsignacionNorm)
            }
            $.SecGetJSON(BASE_URL + "/motor/api/Gestion/lista-estados-gestion", { tipoCampagna: 2, padre: 0 }, function (datos) {
                $("#ges_causa_basal_normalizacion").data("TipoAsignacion", 2);
                $("#ges_causa_basal_normalizacion").html("");
                $("#ges_causa_basal_normalizacion").append($("<option>").attr("value", "").html("Seleccione"));

                $.each(datos, function (i, e) {
                    $("#ges_causa_basal_normalizacion").append($("<option>").attr("value", e.eges_id).html(e.eges_nombre).data("terminal", e.ejes_terminal))
                });
            });
            $.SecGetJSON(BASE_URL + "/motor/api/Gestion/lista-estados-gestion", { tipoCampagna: 2, padre: 10 }, function (datos) {
                $("#ges_consecuencia_normalizacion").data("TipoAsignacion", 2);
                $("#ges_consecuencia_normalizacion").html("");
                $("#ges_consecuencia_normalizacion").append($("<option>").attr("value", "").html("Seleccione"));

                $.each(datos, function (i, e) {
                    $("#ges_consecuencia_normalizacion").append($("<option>").attr("value", e.eges_id).html(e.eges_nombre).data("terminal", e.ejes_terminal))
                });
            });
            $.SecGetJSON(BASE_URL + "/motor/api/Gestion/lista-estados-gestion", { tipoCampagna: 2, padre: 20 }, function (datos) {
                $("#ges_estado_normalizacion").data("TipoAsignacion", 2);
                $("#ges_estado_normalizacion").html("");
                $("#ges_estado_normalizacion").append($("<option>").attr("value", "").html("Seleccione"));

                $.each(datos, function (i, e) {
                    $("#ges_estado_normalizacion").append($("<option>").attr("value", e.eges_id).html(e.eges_nombre).data("terminal", e.ejes_terminal))
                });
            });

            $('#demo-dp-component_normalizacion .input-group.date').datepicker({ autoclose: true, format: 'dd-mm-yyyy', startDate: "0d", language: "es", daysOfWeekDisabled: [6, 0], todayHighlight: true })
                .on('show.bs.modal hide.bs.modal', function (event) {
                    // prevent datepicker from firing bootstrap modal "show.bs.modal"
                    event.stopPropagation();
                });
            $.SecGetJSON(BASE_URL + "/motor/api/Afiliados/obtener-hist-tipo-campana", { RutAfiliado: rutAf, TipoAsignacion: 2 }, function (gesListNor) {
                $("#gestiones_realizadasNorm").html("");
                $.each(gesListNor, function (i, e) {
                    $("#gestiones_realizadasNorm")
                        .append(
                            $("<a>")
                                .append($("<h4>").addClass("list-group-item-heading").html("<strong>Gestor:</strong> " + e.Nombres))
                                .append($("<p>").addClass("list-group-item-text").html("<strong>Fecha Gestión:</strong>" + e.FechaAccion.toFechaHora() + ", <strong>Fecha Prox. Gestión:</strong> " + e.FechaCompromete.toFecha()))
                                .append($("<p>").addClass("list-group-item-text").html("<strong>Estado:</strong> " + e.Estado + ",  <strong>Sub Estado:</strong> " + e.SubEstado))
                                .append($("<p>").addClass("list-group-item-text").html("<strong>Comentario:</strong> " + e.Descripcion))
                        );
                });
            });
        });
        $('#demo-lg-modal-sc').on('show.bs.modal', function (event) {

            var link = $(event.relatedTarget); // Button that triggered the modal
            var AsignacionSC = link.data('asignacion');
            if (typeof AsignacionSC != 'undefined') {
                $("#ges_id_asignacionSC").val(AsignacionSC)
            }

            $.SecGetJSON(BASE_URL + "/motor/api/Gestion/lista-estados-gestion", { tipoCampagna: 4, padre: 0 }, function (datos) {
                $("#ges_estadoSC").data("TipoAsignacion", 4);
                $("#ges_estadoSC").html("");
                $("#ges_estadoSC").append($("<option>").attr("value", "").html("Seleccione"));

                $.each(datos, function (i, e) {
                    $("#ges_estadoSC").append($("<option>").attr("value", e.eges_id).html(e.eges_nombre).data("terminal", e.ejes_terminal))
                });
            });
            $.SecGetJSON(BASE_URL + "/motor/api/Afiliados/obtener-hist-tipo-campana", { RutAfiliado: rutAf, TipoAsignacion: 4 }, function (gesListSC) {
                $("#gestiones_realizadasSC").html("");
                $.each(gesListSC, function (i, e) {
                    $("#gestiones_realizadasSC")
                        .append(
                            $("<a>")
                                .append($("<h4>").addClass("list-group-item-heading").html("<strong>Gestor:</strong> " + e.Nombres))
                                .append($("<p>").addClass("list-group-item-text").html("<strong>Fecha Gestión:</strong>" + e.FechaAccion.toFechaHora() + ", <strong>Fecha Prox. Gestión:</strong> " + e.FechaCompromete.toFecha()))
                                .append($("<p>").addClass("list-group-item-text").html("<strong>Estado:</strong> " + e.Estado + ",  <strong>Sub Estado:</strong> " + e.SubEstado))
                                .append($("<p>").addClass("list-group-item-text").html("<strong>Comentario:</strong> " + e.Descripcion))
                        );
                });
            });

        });
        $('#demo-lg-modal-tmc').on('show.bs.modal', function (event) {

            var link = $(event.relatedTarget); // Button that triggered the modal
            var Asignacion = link.data('asignacion');
            if (typeof Asignacion != 'undefined') {
                $("#ges_id_asignacionTMC").val(Asignacion)
            }

            $.SecGetJSON(BASE_URL + "/CPEngine/api/camp/lista-estges-camp", { cc: 8, cp: 0 }, function (datos) {
                //$("#ges_estado").data("TipoAsignacion", afiData.TipoAsignacion);
                $("#ges_estadoTMC").html("");
                $("#ges_estadoTMC").append($("<option>").attr("value", "").html("Seleccione"));

                $.each(datos, function (i, e) {
                    $("#ges_estadoTMC").append($("<option>").attr("value", e.CodEstado).html(e.Nombre).data("terminal", e.EsTerminal))
                });
            });
            $.SecGetJSON(BASE_URL + "/motor/api/Afiliados/obtener-hist-tipo-campana", { RutAfiliado: rutAf, TipoAsignacion: 8 }, function (gesListTMC) {
                $("#gestiones_realizadasTMC").html("");
                $.each(gesListTMC, function (i, e) {
                    $("#gestiones_realizadasTMC")
                        .append(
                            $("<a>")
                                .append($("<h4>").addClass("list-group-item-heading").html("<strong>Gestor:</strong> " + e.Nombres))
                                .append($("<p>").addClass("list-group-item-text").html("<strong>Fecha Gestión:</strong>" + e.FechaAccion.toFechaHora() + ", <strong>Fecha Prox. Gestión:</strong> " + e.FechaCompromete.toFecha()))
                                .append($("<p>").addClass("list-group-item-text").html("<strong>Estado:</strong> " + e.Estado + ",  <strong>Sub Estado:</strong> " + e.SubEstado))
                                .append($("<p>").addClass("list-group-item-text").html("<strong>Comentario:</strong> " + e.Descripcion))
                        );
                });
            });

        });

        $('#datos-gestion').bootstrapValidator({
            excluded: [':disabled', ':not(:visible)'],
            feedbackIcons: [],
            fields: {
                ges_estado: {
                    validators: {
                        notEmpty: {
                            message: 'Debe seleccionar un estado'
                        }
                    }
                },
                ges_subestado: {
                    validators: {
                        notEmpty: {
                            message: 'Debe seleccionar un sub estado'
                        }
                    }
                },
                ges_prox_gestion: {
                    validators: {
                        notEmpty: {
                            message: 'La fecha de próxima gestión no puede ser vacía'
                        },
                        date: {
                            format: 'DD-MM-YYYY',
                            message: 'Formato de fecha incorrecto'
                        }
                    }
                },
                ges_comentarios: {
                    validators: {
                        notEmpty: {
                            message: 'Debe agregar algún comentario'
                        },
                        stringLength: {
                            message: 'No pueden ser mas de 150 caracteres',
                            max: function (value, validator, $field) {
                                return 150 - (value.match(/\r/g) || []).length;
                            }
                        }
                    }
                },
            }
        }).on('success.form.bv', function (e) {
            // Prevén que se mande el formulario
            e.preventDefault();
            var $form = $(e.target);
            $.SecPostJSON(BASE_URL + "/motor/api/Gestion/guardar-gestion", $form.serialize(), function (respuesta) {


                $("#gestiones_realizadas").html("");
                $.each(respuesta.Objeto, function (i, e) {
                    $("#gestiones_realizadas").append($("<a>").attr("href", '#')
                        .append($("<h4>").addClass("list-group-item-heading").html("<strong>Gestor:</strong> " + e.Gestor.EjecutivoData.Nombres))
                        .append($("<p>").addClass("list-group-item-text").html("<strong>Fecha Gestión:</strong>" + e.GestionBase.FechaAccion.toFechaHora() + ", <strong>Fecha Prox. Gestión:</strong> " + e.GestionBase.FechaCompromete.toFecha()))
                        .append($("<p>").addClass("list-group-item-text").html("<strong>Estado:</strong> " + e.EstadoGestion.eges_nombre + ",  <strong>Sub Estado:</strong> " + e.SubEstadoGestion.eges_nombre))
                        .append($("<p>").addClass("list-group-item-text").html("<strong>Comentario:</strong> " + e.GestionBase.Descripcion))
                    );
                });

                if (respuesta.Objeto.length > 0 && respuesta.Objeto[0].EstadoGestion.ejes_terminal === "CERRADOS") {
                    $(".esconder").hide();
                }

                $("#datos-gestion").bootstrapValidator('resetForm', true);

                $.niftyNoty({
                    type: 'success',
                    container: '#mensahes-mustPre',
                    html: '<strong>OK</strong> Gestion guardada exitosamente.',
                    focus: false,
                    timer: 3000,
                    onHidden: function () {
                        window.location.reload(true);
                    }
                });
            });
        });

        $('#datos-gestion-sc').bootstrapValidator({
            excluded: [':disabled', ':not(:visible)'],
            fields: {
                ges_estadoSC: {
                    validators: {
                        notEmpty: {
                            message: 'Debe seleccionar un estado'
                        }
                    }
                },
                ges_subestadoSC: {
                    validators: {
                        notEmpty: {
                            message: 'Debe seleccionar un sub estado'
                        }
                    }
                },
                ges_prox_gestionSC: {
                    validators: {
                        notEmpty: {
                            message: 'La fecha de próxima gestión no puede ser vacía'
                        },
                        date: {
                            format: 'DD-MM-YYYY',
                            message: 'Formato de fecha incorrecto'
                        }
                    }
                },
                ges_comentariosSC: {
                    validators: {
                        notEmpty: {
                            message: 'Debe agregar algún comentario'
                        },
                        stringLength: {
                            message: 'No pueden ser mas de 150 caracteres',
                            max: function (value, validator, $field) {
                                return 150 - (value.match(/\r/g) || []).length;
                            }
                        }
                    }
                },
            }
        }).on('success.form.bv', function (e) {
            // Prevén que se mande el formulario
            e.preventDefault();
            var $form = $(e.target);

            $.SecPostJSON(BASE_URL + "/motor/api/Gestion/guardar-gestion-normalizacionSC", $form.serialize(), function (respuesta) {

                $("#gestiones_realizadasSC").html("");
                $.each(respuesta.Objeto, function (i, e) {
                    $("#gestiones_realizadasSC").append($("<a>").attr("href", '#')
                        .append($("<h4>").addClass("list-group-item-heading").html("<strong>Gestor:</strong> " + e.Gestor.EjecutivoData.Nombres))
                        .append($("<p>").addClass("list-group-item-text").html("<strong>Fecha Gestión:</strong>" + e.GestionBase.FechaAccion.toFechaHora() + ", <strong>Fecha Prox. Gestión:</strong> " + e.GestionBase.FechaCompromete.toFecha()))
                        .append($("<p>").addClass("list-group-item-text").html("<strong>Estado:</strong> " + e.EstadoGestion.eges_nombre + ",  <strong>Sub Estado:</strong> " + e.SubEstadoGestion.eges_nombre))
                        .append($("<p>").addClass("list-group-item-text").html("<strong>Comentario:</strong> " + e.GestionBase.Descripcion))
                    );
                });

                //console.log(respuesta.Objeto)

                if (respuesta.Objeto.length > 0 && respuesta.Objeto[0].EstadoGestion.ejes_terminal === "CERRADOS") {
                    $(".esconder").hide();
                }


                $("#datos-gestion-sc").bootstrapValidator('resetForm', true);
                //$("#mensaje_guardar").fadeIn();

                $.niftyNoty({
                    type: 'success',
                    container: '#mensahes-mustsc',
                    html: '<strong>OK</strong> Gestion guardada exitosamente.',
                    focus: false,
                    timer: 3000,
                    onHidden: function () {
                        window.location.reload(true);
                    }
                });
            });
        });

        $('#datos-gestion_normalizacion').bootstrapValidator({
            excluded: [':disabled', ':not(:visible)'],

            fields: {
                ges_causa_basal_normalizacion: {
                    validators: {
                        notEmpty: {
                            message: 'Debe seleccionar una causa'
                        }
                    }
                },
                ges_consecuencia_normalizacion: {
                    validators: {
                        notEmpty: {
                            message: 'Debe seleccionar una consecuencia'
                        }
                    }
                },
                ges_estado_normalizacion: {
                    validators: {
                        notEmpty: {
                            message: 'Debe seleccionar un estado'
                        }
                    }
                },
                /*ges_prox_gestion_normalizacion: {
                    validators: {
                        notEmpty: {
                            message: 'La fecha de próxima gestión no puede ser vacía'
                        },
                        date: {
                            format: 'DD-MM-YYYY',
                            message: 'Formato de fecha incorrecto'
                        }
                    }
                },*/
                ges_comentarios_normalizacion: {
                    validators: {
                        notEmpty: {
                            message: 'Debe agregar algún comentario'
                        },
                        stringLength: {
                            message: 'No pueden ser mas de 150 caracteres',
                            max: function (value, validator, $field) {
                                return 150 - (value.match(/\r/g) || []).length;
                            }
                        }
                    }
                },



            }
        }).on('success.form.bv', function (e) {
            // Prevén que se mande el formulario
            e.preventDefault();
            var $form = $(e.target);

            $.SecPostJSON(BASE_URL + "/motor/api/Gestion/guardar-gestion-normalizacion", $form.serialize(), function (respuesta) {

                $("#gestiones_realizadasNorm").html("");
                $.each(respuesta.Objeto, function (i, e) {
                    $("#gestiones_realizadasNorm").append($("<a>").attr("href", '#')
                        .append($("<h4>").addClass("list-group-item-heading").html("<strong>Gestor:</strong> " + e.Gestor.EjecutivoData.Nombres))
                        .append($("<p>").addClass("list-group-item-text").html("<strong>Fecha Gestión:</strong>" + e.GestionBase.FechaAccion.toFechaHora() + ", <strong>Fecha Prox. Gestión:</strong> " + e.GestionBase.FechaCompromete.toFecha()))
                        .append($("<p>").addClass("list-group-item-text").html("<strong>Causa basal:</strong> " + e.CausaBasalGestion.eges_nombre + ",  <strong>Consecuencia:</strong> " + e.ConsecuenciaGestion.eges_nombre + ", <strong>Estado:</strong> " + e.EstadoGestion.eges_nombre))
                        .append($("<p>").addClass("list-group-item-text").html("<strong>Comentario:</strong> " + e.GestionBase.Descripcion))
                    );
                });


                if (respuesta.Objeto.length > 0 && respuesta.Objeto[0].EstadoGestion.ejes_terminal === "CERRADOS") {
                    $(".esconder").hide();
                }

                $("#datos-gestion_normalizacion").bootstrapValidator('resetForm', true);

                $.niftyNoty({
                    type: 'success',
                    container: '#mensahes-mustNor',
                    html: '<strong>OK</strong> Gestion guardada exitosamente.',
                    focus: false,
                    timer: 3000,
                    onHidden: function () {
                        window.location.reload(true);
                    }
                });
            });
        });
        $('#datos-gestion-tmc').bootstrapValidator({
            excluded: [':disabled', ':not(:visible)'],
            fields: {
                ges_estadoTMC: {
                    validators: {
                        notEmpty: {
                            message: 'Debe seleccionar un estado'
                        }
                    }
                },
                ges_subestadoTMC: {
                    validators: {
                        notEmpty: {
                            message: 'Debe seleccionar un sub estado'
                        }
                    }
                },
                ges_prox_gestionTMC: {
                    validators: {
                        notEmpty: {
                            message: 'La fecha de próxima gestión no puede ser vacía'
                        },
                        date: {
                            format: 'DD-MM-YYYY',
                            message: 'Formato de fecha incorrecto'
                        }
                    }
                },
                ges_comentarios: {
                    validators: {
                        notEmpty: {
                            message: 'Debe agregar algún comentario'
                        },
                        stringLength: {
                            message: 'No pueden ser mas de 150 caracteres',
                            max: function (value, validator, $field) {
                                return 150 - (value.match(/\r/g) || []).length;
                            }
                        }
                    }
                },
            }
        }).on('success.form.bv', function (e) {
            // Prevén que se mande el formulario
            e.preventDefault();
            var $form = $(e.target);

            var objeto_ebnvio = {
                ges_estado: $('#ges_estadoTMC').val(),
                ges_subestado: $('#ges_subestadoTMC').val(),
                ges_prox_gestion: $('#ges_prox_gestionTMC').val(),
                ges_comentarios: $('#ges_comentariosTMC').val(),
                ges_id_asignacion: $('#ges_id_asignacionTMC').val(),
                ges_oficina: getCookie("Oficina"),
                ges_token: getCookie("Token")
            }
            $.SecPostJSON(BASE_URL + "/CPEngine/api/camp/guardar-gestion-cmp", objeto_ebnvio, function (respuesta) {


                $("#gestiones_realizadasTMC").html("");
                $.each(respuesta.Objeto, function (i, e) {
                    $("#gestiones_realizadasTMC").append($("<a>").attr("href", '#')
                        .append($("<h4>").addClass("list-group-item-heading").html("<strong>Gestor:</strong> " + e.RutEjecutivo + "  " + e.NombreEjecutivo))
                        .append($("<p>").addClass("list-group-item-text").html("<strong>Fecha Gestión:</strong>" + e.Gestion.FechaAccion.toFechaHora() + ", <strong>Fecha Prox. Gestión:</strong> " + e.Gestion.FechaCompromiso.toFecha()))
                        .append($("<p>").addClass("list-group-item-text").html("<strong>Estado:</strong> " + e.EstadoGestion.Nombre + ",  <strong>Sub Estado:</strong> " + e.SubEstadoGestion.Nombre))
                        .append($("<p>").addClass("list-group-item-text").html("<strong>Comentario:</strong> " + e.Gestion.NotaGestion))
                    );
                });

                if (respuesta.Objeto != null && respuesta.Objeto.length > 0 && respuesta.Objeto[0].EstadoGestion.ejes_terminal === "CERRADOS") {
                    $(".esconder").hide();
                }

                $("#datos-gestion-tmc").bootstrapValidator('resetForm', true);
                //$("#mensaje_guardar").fadeIn();

                $.niftyNoty({
                    type: 'success',
                    container: 'floating',
                    html: '<strong>OK</strong> Gestion guardada exitosamente.',
                    focus: false,
                    timer: 3000,
                    onHidden: function () {
                        window.location.reload(true);
                    }
                });
            });

        });

        var rutAfilado = httpGet("RutBuscar").replace('.', '');
        $("#filtroEstado").change(function () {

            $.getJSON(BASE_URL + "/motor/api/Afiliados/filtro-proyeccion", { RutAfiliado: rutAfilado.replace('.', ''), Estado: $("#filtroEstado").val() }, function (respuesta) {
                $('#AfiProyeccion').html("");
                $.each(respuesta, function (i, e) {
                    var date = new Date(e.Fecha);
                    var options = {
                        year: "numeric", month: "long",
                        day: "numeric", hour: "2-digit", minute: "2-digit"
                    };
                    var i_img;
                    if (e.EstadoGestion == 1) {
                        i_img = $('<img>').attr('src', '../Assets/img/M.png').attr('alt', 'Profile picture')

                        var iB2_4 = $('<a>').html('   Motor')
                        var aB2_5 = $('<a>').addClass('text-main text-bold').html('Gestion:  ').append(iB2_4).append('<br/>')

                        var iB2_4_ = $('<a>').html(e.Estado + '  -  ' + e.SubEstado)
                        var aB2_5_ = $('<a>').addClass('text-main text-bold').html('Motivo:  ').append(iB2_4_)
                    }
                    else {
                        var iB2_4 = $('<a>').html(e.Estado + '        ')
                        var aB2_5 = $('<a>').addClass('text-main text-bold').html('Gestion:  ').append(iB2_4).append('<br/>')
                        var iB2_4_ = $('<a>').html(e.SubEstado)
                        var aB2_5_ = $('<a>').addClass('text-main text-bold').html('Motivo:  ').append(iB2_4_)
                    }

                    if (e.EstadoGestion == 2) {
                        i_img = $('<i>').addClass('demo-psi-speech-bubble-3 icon-lg')
                    }
                    if (e.EstadoGestion == 3) {
                        i_img = $('<img>').attr('src', '../Assets/img/profile-photos/noFono.png').attr('alt', 'Profile picture')
                    }
                    if (e.EstadoGestion == 4) {
                        i_img = $('<i>').addClass('pli-telephone icon-lg')
                    }
                    var divB1_1 = $('<div>').addClass('timeline-icon bg-success').append(i_img)
                    var divB1_2 = $('<div>').addClass('timeline-time').html(date.toLocaleTimeString("es-ES", options))
                    var divB1 = $('<div>').addClass('timeline-stat').append(divB1_1).append(divB1_2)
                    var imgB2 = $('<img>').addClass('img-xs img-circle').attr('src', '../Assets/img/profile-photos/eje2.png').attr('alt', 'Profile picture')
                    var _eje = $('<a>').html(e.Ejecutivo.OrdenaNombre() + '  -  ' + e.Sucursal)
                    var aB2_1 = $('<a>').addClass('btn-link text-main text-bold').html('ingresado por:' + '  ').append(_eje).append('<br/>')
                    var pB2 = $('<p>').addClass('mar-no pad-btm').append(aB2_1).append(aB2_5).append(aB2_5_)
                    var divB2 = $('<div>').addClass('timeline-label').css('border-radius', '5px').css('background-color', '#e3e5e6').append(imgB2).append(pB2)
                    var divPrin = $('<div>').addClass('timeline-entry').append(divB1).append(divB2)
                    $('#AfiProyeccion').append(divPrin)
                });
            });
        });




        $('#form-registro-contacto').bootstrapValidator({
            excluded: [':disabled', ':not(:visible)'],
            feedbackIcons: [],
            fields: {
                cbtippContac: {
                    validators: {
                        notEmpty: {
                            message: 'Debe seleccionar un tipo de Contacto'
                        }
                    }
                },
                cbClasificacionConctac: {
                    validators: {
                        notEmpty: {
                            message: 'Debe seleccionar una clasificación de contacto'
                        }
                    }
                },
                afi_NewContacto: {
                    validators: {
                        notEmpty: {
                            message: 'Debe ingresar un contacto'
                        },
                        stringLength: {
                            message: 'No pueden ser mas de 100 caracteres',
                            max: function (value, validator, $field) {
                                return 150 - (value.match(/\r/g) || []).length;
                            }
                        }
                    }
                }
            }
        }).on('success.form.bv', function (e) {
            // Prevén que se mande el formulario
            e.preventDefault();
            var $form = $(e.target);

            var objeto_envio_contacto = {
                RutAfiliado: rutAf,
                IdTipoContac: $('#cbtippContac').val(),
                GlosaTipoContac: $('select[name="cbtippContac"] option:selected').text(),
                IdClasifContac: $('#cbClasificacionConctac').val(),
                GlosaClasifContac: $('select[name="cbClasificacionConctac"] option:selected').text(),
                DatosContac: $('#afi_NewContacto').val()
            }
            $.SecGetJSON(BASE_URL + "/motor/api/Contactos/ingresa-nuevo-contacto", objeto_envio_contacto, function (datos) {
                $("#form-registro-contacto").bootstrapValidator('resetForm', true);
                $('#demo-lg-modal-new').modal('hide');
                Cargador.CargaDatosContactos(rutAf)
                $.niftyNoty({
                    type: 'success',
                    icon: 'pli-like-2 icon-2x',
                    message: 'Contacto Guardado correctamente.',
                    container: 'floating',
                    timer: 5000
                });
            });

        });


        var rutAf = httpGet("RutBuscar");
        rutAf = rutAf.replace(/\./g, '');
        rutAf = rutAf.substring(0, rutAf.indexOf('-'));
        Cargador.CargaDatosAfiliados(rutAf)
        Cargador.CargaDatosContactos(rutAf)
        Cargador.CargaDatosCampaniasAfiliado(rutAf)
        Cargador.CargaDatosCumpleanos(rutAf)
        Cargador.CargaDatosAlertas(rutAf)
        Cargador.CargaProyeccion()
        Cargador.EstadoEncuesta()


        $("#ges_oficina").val(getCookie("Oficina"))
        $("#ges_token").val(getCookie("Token"))


        /*ENCUESTA*/


        $.SecGetJSON(BASE_URL + "/motor/api/Afiliados/lista-enfermedades-encuesta", function (menus) {
            $("#selectEnfermedad").html("");
            $.each(menus, function (i, e) {
                $("#selectEnfermedad").append($("<option>").attr("value", e.Patologia).html(e.Patologia))
            });
            $('#selectEnfermedad').chosen({ width: '100%' });
        });


        $.SecGetJSON(BASE_URL + "/motor/api/Afiliados/lista-medicamentos-encuesta", function (menus) {
            $("#selectMedicamentos").html("");
            $.each(menus, function (i, e) {
                $("#selectMedicamentos").append($("<option>").attr("value", e.Medicamento).html(e.Medicamento))
            });
            $('#selectMedicamentos').chosen({ width: '100%' });
        });



        $.SecGetJSON(BASE_URL + "/motor/api/perfil-empresas/lista-region-empresa", function (menus) {
            $("#region-encuesta").html("");
            $("#region-encuesta").append($("<option>").attr("value", " ").html("Seleccione"));
            $.each(menus, function (i, e) {
                $("#region-encuesta").append($("<option>").attr("value", e.Region_nombre).html(e.Region_nombre))
            });
            $('#region-encuesta').chosen({ width: '100%' });
        });


        $("input:radio[name=rbEnfermedad]").click(function () {
            switch (this.value) {
                case "SI":
                    $('#divContenedor').css('display', 'block');
                    datosEncuenta.Tiene_Enfermedad = this.value
                    break;
                case "NO":
                    $('#divContenedor').css('display', 'none');
                    datosEncuenta.Tiene_Enfermedad = this.value
                    break;
            }
        });

        $("input:radio[name=chkActividad]").click(function () {
            switch (this.value) {
                case "Trabajador":
                    datosEncuenta.Actividad = this.value
                    break;
                case "Pensionado":
                    datosEncuenta.Actividad = this.value
                    break;
            }
        });

        $("input:radio[name=chkPrevison]").click(function () {
            switch (this.value) {
                case "Fonasa":
                    datosEncuenta.Prevision = this.value
                    break;
                case "Isapre":
                    datosEncuenta.Prevision = this.value
                    break;
            }
        });

        $("input:radio[name=chkSexo]").click(function () {
            switch (this.value) {
                case "Masculino":
                    datosEncuenta.Sexo = this.value
                    break;
                case "Femenino":
                    datosEncuenta.Sexo = this.value
                    break;
            }
        });

        $("input:radio[name=chkEdad]").click(function () {
            switch (this.value) {
                case "18-24":
                    datosEncuenta.Edad = this.value
                    break;
                case "25-34":
                    datosEncuenta.Edad = this.value
                    break;
                case "35-44":
                    datosEncuenta.Edad = this.value
                    break;
                case "45-54":
                    datosEncuenta.Edad = this.value
                    break;
                case "55-64":
                    datosEncuenta.Edad = this.value
                    break;
                case "65-74":
                    datosEncuenta.Edad = this.value
                    break;
                case "75 o mas":
                    datosEncuenta.Edad = this.value
                    break;
            }
        });

        $('#region-encuesta').change(function (e) {
            e.preventDefault();
            if ($(this).val() != '') {
                datosEncuenta.Region = this.value
            }
        });

        $('#ckOtrosEnfermedad').on('click', function () {
            if ($(this).is(':checked')) {
                $('#txtOtrosEnfermedad').removeAttr("disabled");
            } else {
                $('#txtOtrosEnfermedad').attr("disabled", "disabled");
            }
        });
        $('#ckOtrosMedicamentos').on('click', function () {
            if ($(this).is(':checked')) {
                $('#txtOtrosMedicamentos').removeAttr("disabled");
            } else {
                $('#txtOtrosMedicamentos').attr("disabled", "disabled");
            }
        });

        $('#ckOtrosMedicamentos').on('click', function () {
            if ($(this).is(':checked')) {
                $('#txtOtrosMedicamentos').removeAttr("disabled");
            } else {
                $('#txtOtrosMedicamentos').attr("disabled", "disabled");
            }
        });
        $("input:checkbox[name=rbAdMedicamentos]").click(function () {
            switch (this.value) {
                case "Consultorio":
                    datosEncuenta.Adquiere_Consultorio = this.value
                    break;
                case "Farmacia por Canasta GES":
                    datosEncuenta.Adquiere_CanastaGes = this.value
                    break;
                case "Farmacia":
                    datosEncuenta.Adquiere_Farmacia = this.value
                    break;
            }
        });

        $("input:radio[name=chkFarmacias]").click(function () {
            switch (this.value) {
                case "Consultorio":
                    $('#txtOtroCual').attr("disabled", "disabled");
                    $('#txtOtroCual').val("")
                    datosEncuenta.NombreFarmacia = this.value
                    break;
                case "Farmacias Ahumada":
                    $('#txtOtroCual').attr("disabled", "disabled");
                    $('#txtOtroCual').val("")
                    datosEncuenta.NombreFarmacia = this.value
                    break;
                case "Cruz Verde":
                    $('#txtOtroCual').attr("disabled", "disabled");
                    $('#txtOtroCual').val("")
                    datosEncuenta.NombreFarmacia = this.value
                    break;
                case "Salcobrand":
                    $('#txtOtroCual').attr("disabled", "disabled");
                    $('#txtOtroCual').val("")
                    datosEncuenta.NombreFarmacia = this.value
                    break;
                case "Dr. Simi":
                    $('#txtOtroCual').attr("disabled", "disabled");
                    $('#txtOtroCual').val("")
                    datosEncuenta.NombreFarmacia = this.value
                    break;
                case "Farmacia Popular/Comunal":
                    $('#txtOtroCual').attr("disabled", "disabled");
                    $('#txtOtroCual').val("")
                    datosEncuenta.NombreFarmacia = this.value
                    break;
                case "Otra":
                    $('#txtOtroCual').removeAttr("disabled");
                    break;
            }
        });

        var datosEncuenta = {}
        $("#btFinalizar").on("click", function () {
            var Enfermedad = [];
            var medicamento = [];
            var errores = [];

            $('#selectEnfermedad :selected').each(function () {
                Enfermedad.push($(this).val())
            });
            $.each(Enfermedad, function (i, e) {
                datosEncuenta['Enfermedad_' + (i + 1)] = Enfermedad[i];
            });
            if ($('#txtOtrosEnfermedad').val() != "" && Enfermedad.length < 12) {
                Enfermedad.push(datosEncuenta['Enfermedad_' + (Enfermedad.length + 1)] = $('#txtOtrosEnfermedad').val());
            }
            if (Enfermedad.length < 12) {
                var i = Enfermedad.length;
                while (i < 11) {
                    datosEncuenta['Enfermedad_' + (i + 1)] = "NULL"
                    i++;
                }
            }

            $('#selectMedicamentos :selected').each(function () {
                medicamento.push($(this).val())
            });
            $.each(medicamento, function (i, e) {
                datosEncuenta['Medicamentos_' + (i + 1)] = medicamento[i];
            });
            if ($('#txtOtrosMedicamentos').val() != "" && medicamento.length < 17) {
                medicamento.push(datosEncuenta['Medicamentos_' + (medicamento.length + 1)] = $('#txtOtrosMedicamentos').val());
            }
            if (medicamento.length < 17) {
                var i = medicamento.length;
                while (i < 16) {
                    datosEncuenta['Medicamentos_' + (i + 1)] = "NULL"
                    i++;
                }
            }
            if ($('#txtOtroCual').val() != "") {
                datosEncuenta.NombreFarmacia = $('#txtOtroCual').val()
            }

            datosEncuenta.Rut_Afiliado = httpGet("RutBuscar");
            datosEncuenta.Actividad = $("#SegmentoAfi").html();
            datosEncuenta.Nombre_Afiliado = $("#NombreAfiliado").html();
            datosEncuenta.Rut_Ejecutivo = getCookie("Rut");
            datosEncuenta.Sucursal = getCookie("Oficina");
            datosEncuenta.Flag_Encuesta = 1;

            function addValidation(slected, message) {
                if (slected.length == 0) {
                    errores.push(message);
                }
            }

            /*Validacion de:  Farmacias*/
            addValidation($("input[name=chkFarmacias]:checked"), '*Debes seleccionar una Farmacia..')
            addValidation($("input[name=chkSexo]:checked"), '*Debes seleccionar el Genero..')
            addValidation($("input[name=chkEdad]:checked"), '*Debes seleccionar un rago de edad..')
            addValidation($("input[name=chkPrevison]:checked"), '*Debes seleccionar una prevision..')
            addValidation($("input[name=rbAdMedicamentos]:checked"), '*Debes seleccionar adquiere medicamento..')
            addValidation($("#selectEnfermedad").val(), '* Debe selecciona una enfermedad')
            addValidation($("#selectMedicamentos").val(), '* Debe selecciona un medicamento')

            //Verificador final
            if (errores.length > 0 && datosEncuenta.Tiene_Enfermedad == "SI") {
                //  alert(errores.join('\n'));  Tiene_Enfermedad

                $.niftyNoty({
                    type: 'danger',
                    container: 'floating',
                    title: 'Error',
                    message: errores.join('\n'),
                    closeBtn: false,
                    timer: 8000,
                });
                return false;
            }
            else if (datosEncuenta.Tiene_Enfermedad == "NO") {
               // return true;
            }


            //Fin Validaciones

            $.SecPostJSON(BASE_URL + "/motor/api/Afiliados/guarda-encueasta-enfermedades", datosEncuenta, function (respuesta) {

                $.niftyNoty({
                    type: 'success',
                    icon: 'pli-like-2 icon-2x',
                    message: 'Encuesta Grabada Exitosamente.',
                    timer: 5000
                });

                $('#DivEncusta').css('display', 'none')
                $('#lbMenesajeEncuensta').css('display', 'block')
                $('#AlertaEncuesta').css('display', 'none')
                $('input[type="radio"]').prop('checked', false);
                $('input[type="checkbox"]').prop('checked', false);
                $('#txtOtrosEnfermedad').val("");
                $('#txtOtrosMedicamentos').val("");
                $('#txtOtroCual').val("");

            });

        });

        $('#selectEnfermedad').change(function (event) {
            if ($(this).val().length > 10) {
                $.niftyNoty({
                    type: 'danger',
                    container: 'floating',
                    title: 'Error',
                    message: 'Solo puede seleccionar 10 enfermedades.',
                    closeBtn: false,
                    timer: 8000,
                });
            }
        });
        $('#selectMedicamentos').change(function (event) {
            if ($(this).val().length > 15) {
                $.niftyNoty({
                    type: 'danger',
                    container: 'floating',
                    title: 'Error',
                    message: 'Solo puede seleccionar 15 medicamentos.',
                    closeBtn: false,
                    timer: 8000,
                });
            }
        });


    </script>

}
